<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>API Demo â€” Policy Document Processor (Proxy)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f6f8fb; }
    .card { border-radius: 12px; box-shadow: 0 4px 20px rgba(50,50,93,0.06); }
    pre { white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-9 col-lg-7">
        <div class="card p-4 bg-white">
          <h3 class="mb-1">Policy Document API Demo (with Proxy)</h3>
          <p class="text-muted small mb-3">This frontend POSTs to <code>/forward</code> on the same origin. The server forwards to the real API.</p>

          <form id="demoForm">
            <div class="mb-3">
              <label class="form-label">Insurance company</label>
              <input id="insurance_company" class="form-control" placeholder="e.g. Acme Insurance" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Data type</label>
              <input id="data_type" class="form-control" placeholder="e.g. telemedical" required>
            </div>

            <div class="mb-3">
              <label class="form-label">File</label>
              <input id="input_file" type="file" class="form-control" required>
              <div id="fileInfo" class="form-text"></div>
            </div>

            <div class="d-flex gap-2">
              <button id="submitBtn" class="btn btn-primary" type="submit">Send to API</button>
              <button id="resetBtn" class="btn btn-outline-secondary" type="button">Reset</button>
              <div class="ms-auto align-self-center text-muted small">Endpoint: <span class="font-monospace">/forward</span></div>
            </div>
          </form>

          <hr>

          <div id="alerts"></div>

          <div id="resultCard" class="mt-3" style="display:none;">
            <h6>Response JSON</h6>
            <pre id="resultPre" class="bg-light p-3 rounded"></pre>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const form = document.getElementById('demoForm');
  const fileInput = document.getElementById('input_file');
  const fileInfo = document.getElementById('fileInfo');
  const submitBtn = document.getElementById('submitBtn');
  const alerts = document.getElementById('alerts');
  const resultCard = document.getElementById('resultCard');
  const resultPre = document.getElementById('resultPre');
  const resetBtn = document.getElementById('resetBtn');

  fileInput.addEventListener('change', () => {
    const f = fileInput.files[0];
    fileInfo.textContent = f ? `Selected: ${f.name} (${Math.round(f.size/1024)} KB)` : '';
  });

  resetBtn.addEventListener('click', () => {
    form.reset();
    fileInfo.textContent = '';
    alerts.innerHTML = '';
    resultCard.style.display = 'none';
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    alerts.innerHTML = '';
    resultCard.style.display = 'none';
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    const fd = new FormData();
    fd.append('input_file', fileInput.files[0]);
    fd.append('insurance_company', document.getElementById('insurance_company').value);
    fd.append('data_type', document.getElementById('data_type').value);

    try {
      const resp = await fetch('/forward', { method: 'POST', body: fd });
      const text = await resp.text();
      let data;
      try { data = JSON.parse(text); } catch { data = text; }

      if (!resp.ok) {
        alerts.innerHTML = `<div class="alert alert-danger">Error ${resp.status}: <pre>${escapeHtml(JSON.stringify(data, null, 2))}</pre></div>`;
      } else {
        resultPre.textContent = JSON.stringify(data, null, 2);
        resultCard.style.display = 'block';
      }
    } catch (err) {
      alerts.innerHTML = `<div class="alert alert-danger">Network error: ${escapeHtml(err.message)}</div>`;
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send to API';
    }
  });

  function escapeHtml(s) {
    return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
  }
</script>
</body>
</html>
